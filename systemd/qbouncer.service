[Unit]
Description=qBouncer - WireGuard NAT-PMP Port Bouncer for qBittorrent
Documentation=https://github.com/vegardx/qbouncer
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
ExecStart=/opt/qbouncer/venv/bin/qbouncer --config /etc/qbouncer/qbouncer.toml

# Watchdog configuration
WatchdogSec=90
Restart=on-failure
RestartSec=10

# Security hardening
User=qbouncer
Group=qbouncer
NoNewPrivileges=yes
ProtectSystem=strict
ProtectHome=yes
PrivateTmp=yes
PrivateDevices=yes
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=yes
RestrictNamespaces=yes
RestrictRealtime=yes
RestrictSUIDSGID=yes
MemoryDenyWriteExecute=yes
LockPersonality=yes

# Required capabilities
# CAP_NET_RAW: ping for health checks
# CAP_NET_ADMIN: iptables for killswitch (optional feature)
AmbientCapabilities=CAP_NET_RAW CAP_NET_ADMIN
CapabilityBoundingSet=CAP_NET_RAW CAP_NET_ADMIN

# Directories
RuntimeDirectory=qbouncer
StateDirectory=qbouncer
ConfigurationDirectory=qbouncer

# Allow reading wireguard config (for wg show)
ReadOnlyPaths=/etc/wireguard

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=qbouncer

[Install]
WantedBy=multi-user.target
